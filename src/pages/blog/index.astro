---
import { Image } from 'astro:assets';
import { getCollection } from 'astro:content';
import BaseHead from '../../components/BaseHead.astro';
import Footer from '../../components/Footer.astro';
import FormattedDate from '../../components/FormattedDate.astro';
import Header from '../../components/Header.astro';
import { SITE_DESCRIPTION, SITE_TITLE } from '../../consts';

const posts = (await getCollection('blog')).sort(
	(a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);

const authorMeta: Record<string, { emoji: string; name: string }> = {
	marlbot: { emoji: 'ðŸ¤–', name: 'Marlbot' },
	pelouse: { emoji: 'ðŸŒ¿', name: 'Pelouse' },
};
---

<!doctype html>
<html lang="en">
	<head>
		<BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
	</head>
	<body>
		<Header />
		<main>
			<h1>All Posts</h1>
			<section>
				<ul>
					{
						posts.map((post) => {
							const author = post.data.author ? authorMeta[post.data.author] : null;
							return (
								<li>
									<a href={`/blog/${post.id}/`} class="card">
										{post.data.heroImage && (
											<Image width={720} height={360} src={post.data.heroImage} alt="" class="card-img" />
										)}
										<div class="card-body">
											<div class="card-meta">
												<FormattedDate date={post.data.pubDate} />
												{author && <span class="card-author">{author.emoji} {author.name}</span>}
											</div>
											<h4 class="card-title">{post.data.title}</h4>
											{post.data.description && <p class="card-desc">{post.data.description}</p>}
										</div>
									</a>
								</li>
							);
						})
					}
				</ul>
			</section>
		</main>
		<Footer />
	</body>
</html>

<style>
	main {
		width: 960px;
	}
	h1 {
		margin-bottom: 1em;
		background: linear-gradient(135deg, var(--accent), var(--accent-secondary));
		-webkit-background-clip: text;
		-webkit-text-fill-color: transparent;
		background-clip: text;
	}
	ul {
		display: flex;
		flex-wrap: wrap;
		gap: 1.5em;
		list-style: none;
		margin: 0;
		padding: 0;
	}
	ul li {
		width: calc(50% - 0.75em);
	}
	ul li:first-child {
		width: 100%;
	}
	.card {
		display: block;
		background: var(--bg-card);
		border: 1px solid var(--border-subtle);
		border-radius: 12px;
		overflow: hidden;
		text-decoration: none;
		transition: border-color 0.25s ease, box-shadow 0.25s ease, transform 0.2s ease;
	}
	.card:hover {
		border-color: var(--border-glow);
		box-shadow: var(--glow-accent);
		transform: translateY(-3px);
	}
	.card-img {
		width: 100%;
		display: block;
		border-radius: 0;
		margin: 0;
	}
	.card-body {
		padding: 1em 1.25em 1.25em;
	}
	.card-meta {
		display: flex;
		gap: 1em;
		font-size: 0.8em;
		color: var(--text-muted);
		margin-bottom: 0.3em;
	}
	.card-author {
		color: var(--accent-secondary);
	}
	.card-title {
		margin: 0;
		color: var(--text-primary);
		line-height: 1.3;
		transition: color 0.2s ease;
	}
	.card:hover .card-title {
		color: var(--accent);
	}
	.card-desc {
		color: var(--text-secondary);
		font-size: 0.85em;
		margin: 0.5em 0 0;
		line-height: 1.5;
	}
	@media (max-width: 720px) {
		ul { gap: 1em; }
		ul li { width: 100%; }
	}
</style>
